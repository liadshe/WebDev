<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Main Page</title>
  <link rel="stylesheet" href="/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="settings-page">
  <div class="sidebar">
    <a href="/main" class="back-link">
        â† Back to main page
    </a>
    <a href="/settings">Manage Profiles</a>
    <a href="/statistics" class="active">Statistics</a>
  </div>
  <h2 style="text-align: left;">ğŸ“Š Genres Popularity</h2>

  <div style="display: block;">
      <canvas id="genrePopularityChart"></canvas>
      <p id="no-data-message" style="display: none; text-align: center; color: var(--color-gray-300);">
        No genre data available to display.
      </p>
  </div>

  <script>
    // Safely inject genre data from server (escaped to prevent parsing errors)
    const chartData = <%- JSON.stringify(genreData || []) %>;

    if (chartData.length > 0) {
        const labels = chartData.map(item => item.label);
        const dataValues = chartData.map(item => item.value);

        // Generate random colors for each genre
        function generateRandomColors(count) {
          const colors = [];
          for (let i = 0; i < count; i++) {
            const r = Math.floor(Math.random() * 255);
            const g = Math.floor(Math.random() * 255);
            const b = Math.floor(Math.random() * 255);
            colors.push(`rgb(${r}, ${g}, ${b})`);
          }
          return colors;
        }

        const backgroundColors = generateRandomColors(labels.length);
        const ctx = document.getElementById('genrePopularityChart').getContext('2d');

        new Chart(ctx, {
            type: 'pie',
            data: {
                labels,
                datasets: [{
                    label: 'Genre Frequency',
                    data: dataValues,
                    backgroundColor: backgroundColors,
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom' },
                    title: {
                        display: true,
                        text: 'Favorite Genre Popularity Across User Profiles'
                    }
                }
            }
        });
    } else {
        document.getElementById('no-data-message').style.display = 'block';
    }
  </script>
</body>
</html>
