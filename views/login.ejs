<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Login Page</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body class="login-page">
    <% if (error) { %>
    <div id="error-banner" class="popup-banner"><%= error %></div>
    <script>
      window.onload = function () {
        var banner = document.getElementById("error-banner");
        if (banner) {
          setTimeout(function () {
            banner.style.display = "none";
          }, 2000);
        }
      };
    </script>
    <% } %>

    <div class="login-box">
      <h1 id="form-title">Welcome</h1>
      <form id="authForm" method="POST" action="/login">
        <input type="email" name="email" placeholder="Email" required />
        <input
          type="password"
          name="password"
          placeholder="Password"
          required
        />
        <input
          type="text"
          name="username"
          id="usernameField"
          placeholder="Username"
          style="display: none"
        />

        <button id="submitBtn" type="submit" class="btn">Login</button>
      </form>

      <div class="register-section">
        <p id="toggleText">Don’t have an account?</p>
        <button class="btn secondary" id="toggleBtn">Register</button>
      </div>
    </div>

    <script>
      const toggleBtn = document.getElementById("toggleBtn");
      const toggleText = document.getElementById("toggleText");
      const usernameField = document.getElementById("usernameField");
      const form = document.getElementById("authForm");
      const submitBtn = document.getElementById("submitBtn");
      const title = document.getElementById("form-title");

      let isRegister = false;

      toggleBtn.addEventListener("click", function () {
        isRegister = !isRegister;
        console.log(isRegister);
        if (isRegister) {
          // Switch to register mode
          usernameField.style.display = "block";
          usernameField.required = true;
          form.action = "/register";
          submitBtn.textContent = "Register";
          toggleBtn.textContent = "Login";
          toggleText.textContent = "Already have an account?";
          title.textContent = "Create Account";
        } else {
          // Switch to login mode
          usernameField.style.display = "none";
          usernameField.required = false;
          form.action = "/login";
          submitBtn.textContent = "Login";
          toggleBtn.textContent = "Register";
          toggleText.textContent = "Don’t have an account?";
          title.textContent = "Welcome";
        }
      });
    </script>

    <% if (showRegister) { %>
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const toggleBtn = document.getElementById("toggleBtn");
        if (toggleBtn) {
          toggleBtn.click(); // switch automatically to register mode after failing register
        }
      });
    </script>
    <% } %>
  </body>
</html>
