<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Page</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/main.css" />
    <link rel="stylesheet" href="/css/settings.css" />
    <link rel="stylesheet" href="/css/search.css" />
   </head>
  <body class="main-page">
    <%- include('partials/header') %>
    <main>
      <h1>Hello, <%= user.username %></h1>
    <!-- Most Popular Section -->
      <% if ((typeof sortOption === 'undefined' || sortOption === 'default') && typeof mostPopular !== 'undefined' && mostPopular.length > 0) { %>
        <section class="genre-section" data-genre="popular"> 
          <h2>
            Most Popular
            <span style="font-size: 0.9rem; color: #aaa; font-weight: normal;"> - Trending Now</span>
          </h2>

          <div class="genre-row">
            <% mostPopular.forEach(movie => { %>
              <div class="cover popular-item" id="<%= movie._id %>" data-type="<%= movie.type %>">
                <img
                  src="<%= movie.coverImagePath %>"
                  alt="<%= movie.title %>"
                  class="cover-image"
                />
              </div>
            <% }) %>
          </div>
        </section>
      <% } %>

      <!-- Personalized Recommendations Section -->
      <% if ((typeof sortOption === 'undefined' || sortOption === 'default') && typeof personalizedRecommendations !== 'undefined' && personalizedRecommendations.length > 0) { %>
        <section class="genre-section" data-genre="recommended"> 
          <h2>
            Recommended for You
            <span style="font-size: 0.9rem; color: #aaa; font-weight: normal;"> - Based on your preferences</span>
          </h2>

          <div class="genre-row">
            <% personalizedRecommendations.forEach(movie => { %>
              <div class="cover recommended-item" id="<%= movie._id %>" data-type="<%= movie.type %>">
                <img
                  src="<%= movie.coverImagePath %>"
                  alt="<%= movie.title %>"
                  class="cover-image"
                />
              </div>
            <% }) %>
          </div>
        </section>
      <% } %>


      <% for (let genre in moviesByGenre) { %>
        <% if (moviesByGenre[genre].length > 0) { %>
          <section class="genre-section" data-genre="<%= genre %>"> 
            <h2>
              <%= genre %>
              <% if (typeof sortOption !== 'undefined' && sortOption === 'newest') { %>
                <span style="font-size: 0.9rem; color: #aaa; font-weight: normal;"> - 10 Newest</span>
              <% } %>
            </h2>

            <div class="genre-row" >
              <% moviesByGenre[genre].forEach(movie => { %>
                <div class="cover" id="<%= movie._id %>" data-type="<%= movie.type %>">
                  <img
                    src="<%= movie.coverImagePath %>"
                    alt="<%= movie.title %>"
                    class="cover-image"
                  />
                </div>
              <% }) %>
            </div>
          </section>
        <% } %>
      <% } %>

<!-- content details modal -->
<div id="contentModal" class="modal">
  <div class="modal-content">
    <span id="modalClose" class="close">&times;</span>

    <div class="modal-image-container">
      <img id="modalCover" src="" alt="Cover">
      <!-- ▶️ Play button with visible icon -->
      <button id="modalPlayBtn" class="play-btn"></button>
    </div>

    <h2 id="modalTitle"></h2>
    <p id="modalDescription"></p>

    <div id="modalExtra"></div>

    <!-- Watch status for movies -->
    <div id="modalWatchStatus" class="watch-status" style="margin-top: 10px;"></div>

    <!-- Episodes will be injected here dynamically -->
    <div id="modalEpisodes"></div>
  </div>
</div>

    </main>
  <script src="/js/content-details.js"> </script>
  <script src="/js/content-filter.js"></script>
  </body>
</html>
